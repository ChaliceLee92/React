<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script crossorigin src="https://unpkg.com/react@16/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js"></script>
    <script src="https://cdn.bootcss.com/prop-types/15.7.2/prop-types.js"></script>
    <title>React ç”Ÿå‘½å‘¨æœŸ</title>
</head>

<body>
    <div id="app"></div>
</body>

</html>
<script type="text/babel">

    /**
        React ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ: 
                        ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸå¯åˆ†æˆä¸‰ä¸ªçŠ¶æ€(é˜¶æ®µ)ï¼š
                                                Mountingï¼šå·²æ’å…¥çœŸå® DOMï¼ˆæŒ‚è½½é˜¶æ®µï¼‰
                                                Updatingï¼šæ­£åœ¨è¢«é‡æ–°æ¸²æŸ“(æ›´æ–°é˜¶æ®µ)
                                                Unmountingï¼šå·²ç§»å‡ºçœŸå® DOM(å¸è½½é˜¶æ®µ)

                        React16åºŸå¼ƒçš„ä¸‰ä¸ªç”Ÿå‘½å‘¨æœŸå‡½æ•°: 
                                                    componentWillMount
                                                    componentWillReceiveProps
                                                    componentWillUpdate
                                            
                                            æ³¨æ„:  ç›®å‰åœ¨16ç‰ˆæœ¬ä¸­componentWillMountï¼ŒcomponentWillReceivePropsï¼ŒcomponentWillUpdateå¹¶æœªå®Œå…¨åˆ é™¤è¿™ä¸‰ä¸ªç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼Œè€Œä¸”æ–°å¢äº†UNSAFE_componentWillMountï¼ŒUNSAFE_componentWillReceivePropsï¼ŒUNSAFE_componentWillUpdateä¸‰ä¸ªå‡½æ•°ï¼Œå®˜æ–¹è®¡åˆ’åœ¨17ç‰ˆæœ¬å®Œå…¨åˆ é™¤è¿™ä¸‰ä¸ªå‡½æ•°ï¼Œåªä¿ç•™UNSAVE_å‰ç¼€çš„ä¸‰ä¸ªå‡½æ•°ï¼Œç›®çš„æ˜¯ä¸ºäº†å‘ä¸‹å…¼å®¹ï¼Œä½†æ˜¯å¯¹äºå¼€å‘è€…è€Œè¨€åº”è¯¥å°½é‡é¿å…ä½¿ç”¨ä»–ä»¬ï¼Œè€Œæ˜¯ä½¿ç”¨æ–°å¢çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°æ›¿ä»£å®ƒä»¬

                        å–è€Œä»£ä¹‹çš„æ˜¯ä¸¤ä¸ªæ–°çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼š 
                                                    static getDerivedStateFromProps
                                                    getSnapshotBeforeUpdate



                        æŒ‚è½½é˜¶æ®µ(åªä¼šè§¦å‘ä¸€æ¬¡): 
                                            constructor: 
                                                        ç»„ä»¶æ„é€ å‡½æ•°ï¼Œç¬¬ä¸€ä¸ªè¢«æ‰§è¡Œ,å¦‚æœæ²¡æœ‰æ˜¾ç¤ºå®šä¹‰å®ƒï¼Œæˆ‘ä»¬ä¼šæ‹¥æœ‰ä¸€ä¸ªé»˜è®¤çš„æ„é€ å‡½æ•°,å¦‚æœæ˜¾ç¤ºå®šä¹‰äº†æ„é€ å‡½æ•°ï¼Œæˆ‘ä»¬å¿…é¡»åœ¨æ„é€ å‡½æ•°ç¬¬ä¸€è¡Œæ‰§è¡Œsuper(props)ï¼Œå¦åˆ™æˆ‘ä»¬æ— æ³•åœ¨æ„é€ å‡½æ•°é‡Œæ‹¿åˆ°thiså¯¹è±¡ï¼Œè¿™äº›éƒ½å±äºES6çš„çŸ¥è¯†,åœ¨æ„é€ å‡½æ•°é‡Œé¢æˆ‘ä»¬ä¸€èˆ¬ä¼šåšä¸¤ä»¶äº‹ï¼š 1. åˆå§‹åŒ–stateå¯¹è±¡(ç¦æ­¢åœ¨æ„é€ å‡½æ•°ä¸­è°ƒç”¨setStateï¼Œå¯ä»¥ç›´æ¥ç»™stateè®¾ç½®åˆå§‹å€¼) ; 2. ç»™è‡ªå®šä¹‰æ–¹æ³•ç»‘å®šthis
                                            
                                            static getDerivedStateFromProps(nextProps, prevState):
                                                        ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œæ‰€ä»¥ä¸èƒ½åœ¨è¿™ä¸ªå‡½æ•°é‡Œé¢ä½¿ç”¨thisï¼Œè¿™ä¸ªå‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•°propså’Œstateï¼Œåˆ†åˆ«æŒ‡æ¥æ”¶åˆ°çš„æ–°å‚æ•°å’Œå½“å‰çš„stateå¯¹è±¡ï¼Œè¿™ä¸ªå‡½æ•°ä¼šè¿”å›ä¸€ä¸ªå¯¹è±¡ç”¨æ¥æ›´æ–°å½“å‰çš„stateå¯¹è±¡ï¼Œå¦‚æœä¸éœ€è¦æ›´æ–°å¯ä»¥è¿”å›null, è¯¥å‡½æ•°ä¼šåœ¨æŒ‚è½½æ—¶ï¼Œæ¥æ”¶åˆ°æ–°çš„propsï¼Œè°ƒç”¨äº†setStateå’ŒforceUpdateæ—¶è¢«è°ƒç”¨,è¿™ä¸ªæ–¹æ³•å°±æ˜¯ä¸ºäº†å–ä»£ä¹‹å‰çš„componentWillMountã€componentWillReceivePropså’ŒcomponentWillUpdateå½“æˆ‘ä»¬æ¥æ”¶åˆ°æ–°çš„å±æ€§æƒ³å»ä¿®æ”¹æˆ‘ä»¬stateï¼Œå¯ä»¥ä½¿ç”¨getDerivedStateFromProps

                                            render:
                                                    Reactä¸­æœ€æ ¸å¿ƒçš„æ–¹æ³•ï¼Œä¸€ä¸ªç»„ä»¶ä¸­å¿…é¡»è¦æœ‰è¿™ä¸ªæ–¹æ³•!ã€‚
                                                    è¿”å›çš„ç±»å‹æœ‰ä»¥ä¸‹å‡ ç§ï¼š
                                                                    1. åŸç”Ÿçš„DOMï¼Œå¦‚div
                                                                    2. Fragmentï¼ˆç‰‡æ®µ , React16æ–°å¢ï¼‰
                                                                    3. Portalsï¼ˆæ’æ§½ , React16æ–°å¢ï¼‰
                                                                    4. å­—ç¬¦ä¸²å’Œæ•°å­—ï¼Œè¢«æ¸²æŸ“æˆtextèŠ‚ç‚¹
                                                                    5. Booleanå’Œnullï¼Œä¸ä¼šæ¸²æŸ“ä»»ä½•ä¸œè¥¿
                                                    renderå‡½æ•°æ˜¯çº¯å‡½æ•°ï¼Œé‡Œé¢åªåšä¸€ä»¶äº‹ï¼Œå°±æ˜¯è¿”å›éœ€è¦æ¸²æŸ“çš„ä¸œè¥¿ï¼Œä¸åº”è¯¥åŒ…å«å…¶å®ƒçš„ä¸šåŠ¡é€»è¾‘ï¼Œå¦‚æ•°æ®è¯·æ±‚ï¼Œå¯¹äºè¿™äº›ä¸šåŠ¡é€»è¾‘è¯·ç§»åˆ°componentDidMountå’ŒcomponentDid Updateä¸­

                                            componentDidMount:
                                                            ç»„ä»¶æŒ‚è½½ä¹‹åè°ƒç”¨ï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥è·å–åˆ°DOMèŠ‚ç‚¹å¹¶æ“ä½œï¼Œæ¯”å¦‚å¯¹canvasï¼Œsvgçš„æ“ä½œï¼ŒæœåŠ¡å™¨è¯·æ±‚ï¼Œè®¢é˜…éƒ½å¯ä»¥å†™åœ¨è¿™ä¸ªé‡Œé¢ï¼Œä½†æ˜¯è®°å¾—åœ¨componentWillUnmountä¸­å–æ¶ˆè®¢é˜…ï¼Œåœ¨componentDidMountä¸­è°ƒç”¨setStateä¼šè§¦å‘ä¸€æ¬¡é¢å¤–çš„æ¸²æŸ“ï¼Œå¤šè°ƒç”¨äº†ä¸€æ¬¡renderå‡½æ•°ï¼Œä½†æ˜¯ç”¨æˆ·å¯¹æ­¤æ²¡æœ‰æ„ŸçŸ¥ï¼Œå› ä¸ºå®ƒæ˜¯åœ¨æµè§ˆå™¨åˆ·æ–°å±å¹•å‰æ‰§è¡Œçš„ï¼Œä½†æ˜¯æˆ‘ä»¬åº”è¯¥åœ¨å¼€å‘ä¸­é¿å…å®ƒï¼Œå› ä¸ºå®ƒä¼šå¸¦æ¥ä¸€å®šçš„æ€§èƒ½é—®é¢˜ï¼Œæˆ‘ä»¬åº”è¯¥åœ¨constructorä¸­åˆå§‹åŒ–æˆ‘ä»¬çš„stateå¯¹è±¡ï¼Œè€Œä¸åº”è¯¥åœ¨componentDidMountè°ƒç”¨stateæ–¹æ³•

                                            componentWillMount/UNSAVE_componentWillMount ï¼ˆè¿™ä¸¤ä¸ªä¸å»ºè®®ä½¿ç”¨äº†ï¼‰


                        æ›´æ–°é˜¶æ®µ:
                                æ›´æ–°é˜¶æ®µï¼Œå½“ç»„ä»¶çš„propsæ”¹å˜äº†ï¼Œæˆ–ç»„ä»¶å†…éƒ¨è°ƒç”¨äº†setStateæˆ–è€…forceUpdateå‘ç”Ÿï¼Œä¼šå‘ç”Ÿå¤šæ¬¡ã€‚
                                è¿™ä¸ªé˜¶æ®µçš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°è°ƒç”¨å¦‚ä¸‹ï¼š
                                                        componentWillReceiveProps/UNSAFE_componentWillReceiveProps(è¿™ä¸¤ä¸ªä¸æ¨èä½¿ç”¨äº†)

                                                        getDerivedStateFromProps: 
                                                                                è®°ä½åœ¨æ›´æ–°é˜¶æ®µï¼Œæ— è®ºæˆ‘ä»¬æ¥æ”¶åˆ°æ–°çš„å±æ€§ï¼Œè°ƒç”¨äº†setStateè¿˜æ˜¯è°ƒç”¨äº†forceUpdateï¼Œè¿™ä¸ªæ–¹æ³•éƒ½ä¼šè¢«è°ƒç”¨

                                                        shouldComponentUpdate(nextProps, nextState):
                                                                                æœ‰ä¸¤ä¸ªå‚æ•°nextPropså’ŒnextStateï¼Œè¡¨ç¤ºæ–°çš„å±æ€§å’Œå˜åŒ–ä¹‹åçš„stateï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œtrueè¡¨ç¤ºä¼šè§¦å‘é‡æ–°æ¸²æŸ“ï¼Œfalseè¡¨ç¤ºä¸ä¼šè§¦å‘é‡æ–°æ¸²æŸ“ï¼Œé»˜è®¤è¿”å›true ï¼Œ æ³¨æ„å½“æˆ‘ä»¬è°ƒç”¨forceUpdateå¹¶ä¸ä¼šè§¦å‘æ­¤æ–¹æ³• ï¼Œ å› ä¸ºé»˜è®¤æ˜¯è¿”å›trueï¼Œä¹Ÿå°±æ˜¯åªè¦æ¥æ”¶åˆ°æ–°çš„å±æ€§å’Œè°ƒç”¨äº†setStateéƒ½ä¼šè§¦å‘é‡æ–°çš„æ¸²æŸ“ï¼Œè¿™ä¼šå¸¦æ¥ä¸€å®šçš„æ€§èƒ½é—®é¢˜ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å°†this.propsä¸nextPropsä»¥åŠthis.stateä¸nextStateè¿›è¡Œæ¯”è¾ƒæ¥å†³å®šæ˜¯å¦è¿”å›falseï¼Œæ¥å‡å°‘é‡æ–°æ¸²æŸ“

                                                        componentWillUpdate/UNSAFE_componentWillUpdateï¼ˆè¿™ä¸¤ä¸ªä¸æ¨èä½¿ç”¨äº†ï¼‰

                                                        render:
                                                                æ›´æ–°é˜¶æ®µä¹Ÿä¼šè§¦å‘ã€‚

                                                        getSnapshotBeforeUpdate(prevProps, prevState): 
                                                                è¿™ä¸ªæ–¹æ³•åœ¨renderä¹‹åï¼ŒcomponentDidUpdateä¹‹å‰è°ƒç”¨ï¼Œæœ‰ä¸¤ä¸ªå‚æ•°prevPropså’ŒprevStateï¼Œè¡¨ç¤ºä¹‹å‰çš„å±æ€§å’Œä¹‹å‰çš„stateï¼Œè¿™ä¸ªå‡½æ•°æœ‰ä¸€ä¸ªè¿”å›å€¼ï¼Œä¼šä½œä¸ºç¬¬ä¸‰ä¸ªå‚æ•°ä¼ ç»™componentDidUpdateï¼Œå¦‚æœä½ ä¸æƒ³è¦è¿”å›å€¼ï¼Œè¯·è¿”å›nullï¼Œä¸å†™çš„è¯æ§åˆ¶å°ä¼šæœ‰è­¦å‘Š,è¿˜æœ‰è¿™ä¸ªæ–¹æ³•ä¸€å®šè¦å’ŒcomponentDidUpdateä¸€èµ·ä½¿ç”¨ï¼Œå¦åˆ™æ§åˆ¶å°ä¹Ÿä¼šæœ‰è­¦å‘Š(è¿™ä¸ªæ–¹æ³•æ˜¯ç”¨æ¥ä»£æ›¿componentWillUpdate/UNSAVE_componentWillUpdate)

                                                        componentDidUpdate(prevProps, prevState, snapshot):
                                                                è¯¥æ–¹æ³•åœ¨getSnapshotBeforeUpdateæ–¹æ³•ä¹‹åè¢«è°ƒç”¨ï¼Œæœ‰ä¸‰ä¸ªå‚æ•°prevPropsï¼ŒprevStateï¼Œsnapshotï¼Œè¡¨ç¤ºä¹‹å‰çš„propsï¼Œä¹‹å‰çš„stateï¼Œå’Œsnapshotã€‚ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯getSnapshotBeforeUpdateè¿”å›çš„åœ¨è¿™ä¸ªå‡½æ•°é‡Œæˆ‘ä»¬å¯ä»¥æ“ä½œDOMï¼Œå’Œå‘èµ·æœåŠ¡å™¨è¯·æ±‚ï¼Œè¿˜å¯ä»¥setStateï¼Œä½†æ˜¯æ³¨æ„ä¸€å®šè¦ç”¨ifè¯­å¥æ§åˆ¶ï¼Œå¦åˆ™ä¼šå¯¼è‡´æ— é™å¾ªç¯

                        å¸è½½é˜¶æ®µ:
                                å¸è½½é˜¶æ®µï¼Œå½“æˆ‘ä»¬çš„ç»„ä»¶è¢«å¸è½½æˆ–è€…é”€æ¯äº†,è¿™ä¸ªé˜¶æ®µçš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°åªæœ‰ä¸€ä¸ªï¼š
                                    componentWillUnmount
                                å½“æˆ‘ä»¬çš„ç»„ä»¶è¢«å¸è½½æˆ–è€…é”€æ¯äº†å°±ä¼šè°ƒç”¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿™ä¸ªå‡½æ•°é‡Œå»æ¸…é™¤ä¸€äº›å®šæ—¶å™¨ï¼Œå–æ¶ˆç½‘ç»œè¯·æ±‚ï¼Œæ¸…ç†æ— æ•ˆçš„DOMå…ƒç´ ç­‰åƒåœ¾æ¸…ç†å·¥ä½œæ³¨æ„ä¸è¦åœ¨è¿™ä¸ªå‡½æ•°é‡Œå»è°ƒç”¨setStateï¼Œå› ä¸ºç»„ä»¶ä¸ä¼šé‡æ–°æ¸²æŸ“äº†


                        æŸ¥çœ‹ React v16.4 ç”Ÿå‘½å‘¨æœŸï¼š
                                                http://projects.wojtekmaj.pl/react-lifecycle-methods-diagram/
    
    */



    class MyComponent extends React.Component {

        // constructor æ„é€ å‡½æ•° æ˜¯æ¯å½“ç»„ä»¶è¢«åˆ›å»ºçš„æ—¶å€™ å³è§¦å‘
        constructor(props) {
            super(props);
            this.state = {
                opacity: 1,
                isScrollingDown: false,
                lastRow: null
            }
            this.removerComponent = this.removerComponent.bind(this)
        }

        componentDidMount() {     // åœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“åè°ƒç”¨ï¼Œåªåœ¨å®¢æˆ·ç«¯ã€‚ä¹‹åç»„ä»¶å·²ç»ç”Ÿæˆäº†å¯¹åº”çš„DOMç»“æ„ï¼Œå¯ä»¥é€šè¿‡this.getDOMNode()æ¥è¿›è¡Œè®¿é—®ã€‚ å¦‚æœä½ æƒ³å’Œå…¶ä»–JavaScriptæ¡†æ¶ä¸€èµ·ä½¿ç”¨ï¼Œå¯ä»¥åœ¨è¿™ä¸ªæ–¹æ³•ä¸­è°ƒç”¨setTimeout, setIntervalæˆ–è€…å‘é€AJAXè¯·æ±‚ç­‰æ“ä½œ(é˜²æ­¢å¼‚æ­¥æ“ä½œé˜»å¡UI)ã€‚
            this.timer = setInterval(() => {     //  æ³¨æ„ï¼Œ å®šæ—¶å™¨ä¸­çš„thisæŒ‡å‘çš„æ˜¯window ã€‚ä½†æ˜¯ä½¿ç”¨ç®­å¤´å‡½æ•°å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¦åˆ™è¦æ”¹å˜thisæŒ‡å‘
                console.log("å®šæ—¶å™¨");
                let { opacity } = this.state
                opacity -= 0.1
                if (opacity <= 0) {
                    opacity = 1
                }
                this.setState({ opacity })
            }, 200);
        }

        // å‡½æ•°ä¼šåœ¨æŒ‚è½½æ—¶ï¼Œæ¥æ”¶åˆ°æ–°çš„propsï¼Œè°ƒç”¨äº†setStateå’ŒforceUpdateæ—¶è¢«è°ƒç”¨
        static getDerivedStateFromProps(nextProps, prevState) {
            // console.log('%c ğŸ‡ prevState: ', 'font-size:20px;background-color: #6EC1C2;color:#fff;', prevState);
            // console.log('%c ğŸ‹ nextProps: ', 'font-size:20px;background-color: #B03734;color:#fff;', nextProps);
            if (nextProps.currentRow !== prevState.lastRow) {
                return {
                    isScrollingDown:
                        nextProps.currentRow > prevState.lastRow,
                    lastRow: nextProps.currentRow
                }
            }
            return null
        }


        shouldComponentUpdate(nextProps,nextState){
            console.log('%c ğŸ¥’ nextState: ', 'font-size:20px;background-color: #F5CE50;color:#fff;', nextState);
            console.log('%c ğŸŒ½ nextProps: ', 'font-size:20px;background-color: #3F7CFF;color:#fff;', nextProps);
            // this.propsä¸nextPropsä»¥åŠthis.stateä¸nextStateè¿›è¡Œæ¯”è¾ƒæ¥å†³å®šæ˜¯å¦è¿”å›falseï¼Œæ¥å‡å°‘é‡æ–°æ¸²æŸ“
            return true  // é»˜è®¤è¿”å›  true
        }

        componentWillUnmount() {   // ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼Œ åœ¨ç»„ä»¶è¢«ç§»é™¤ä¹‹å‰è¿›è¡Œä¸€äº›æ“ä½œ
            clearInterval(this.timer) // æ³¨æ„ï¼Œ å½“ç”¨æˆ·ç‚¹å‡»åˆ é™¤èŠ‚ç‚¹çš„æ—¶å€™éœ€è¦æŠŠå®šæ—¶å™¨ä¹Ÿå…³é—­ï¼Œå¦åˆ™å°†æŒç»­æ‰§è¡Œï¼Œè¿™è¢«ç§°ä¸ºå†…å­˜æ³„éœ²
        }


        removerComponent() {
            ReactDOM.unmountComponentAtNode(document.getElementById('app'))  // ä»DOMå…ƒç´ ä¸­ç§»é™¤å·²æŒ‚è½½çš„Reactç»„ä»¶ï¼Œæ¸…é™¤å®ƒçš„äº‹ä»¶å¤„ç†å™¨å’Œstate
        }

        render() {
            const { opacity } = this.state
            return (
                <div>
                    <h1 style={{ opacity }}>å¯Œå©†ç­‰ç­‰æˆ‘...</h1>
                    <button onClick={this.removerComponent}>over</button>
                </div>
            )
        }
    }




    ReactDOM.render(<MyComponent />, document.getElementById('app'))

</script>